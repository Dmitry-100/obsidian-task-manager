# ADR 0018: Obsidian Sync Integration

## Status

Accepted

## Context

Task Manager Ğ½ÑƒĞ¶Ğ´Ğ°ĞµÑ‚ÑÑ Ğ² Ğ´Ğ²ÑƒÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½ĞµĞ¹ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡ Ñ Obsidian vault, Ğ³Ğ´Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Tasks Plugin. Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ:

1. ĞŸĞ°Ñ€ÑĞ¸Ñ‚ÑŒ markdown Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°Ğ¼Ğ¸ Ğ¸Ğ· Obsidian
2. ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
3. Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ°Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ñ‹ Ğ¿Ñ€Ğ¸ Ñ€Ğ°ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
4. Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾ Ğ² Obsidian Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚

## Decision

### ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Obsidian Vault                           â”‚
â”‚  00_Inbox/TODO*.md â”‚ 01_Projects/*/Tasks.md                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Obsidian Parser    â”‚
                   â”‚  (src/integrations) â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼               â–¼               â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   Backend   â”‚   â”‚  Frontend   â”‚   â”‚  Database   â”‚
     â”‚  /sync API  â”‚   â”‚  Sync Page  â”‚   â”‚  SyncLog    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

#### 1. Obsidian Parser (`src/integrations/obsidian/parser.py`)

ĞŸĞ°Ñ€ÑĞ¸Ñ‚ Tasks Plugin Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚:
```markdown
- [ ] Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° ğŸ”¼ ğŸ“… 2026-01-25 #tag1 #tag2
- [x] Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ğ°Ñ â« ğŸ“… 2026-01-20 âœ… 2026-01-22
```

Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚:
- `status`: `[ ]` â†’ todo, `[x]` â†’ done
- `title`: Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ¾ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ emoji/Ñ‚ĞµĞ³Ğ°
- `priority`: ğŸ”ºâ†’critical, â«â†’high, ğŸ”¼â†’medium, ğŸ”½â†’low
- `due_date`: ğŸ“… YYYY-MM-DD
- `tags`: #tag1 #tag2
- `completed_at`: âœ… YYYY-MM-DD

#### 2. Project Resolver (`src/integrations/obsidian/project_resolver.py`)

ĞšĞ°ÑĞºĞ°Ğ´Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:
1. Ğ¯Ğ²Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞ³ `#project/ĞšĞ¥ĞŸ` â†’ "Ğ¡Ñ‚Ğ¾Ğ»Ğ¾Ğ²Ğ°Ñ ĞšĞ¥ĞŸ"
2. Ğ¡ĞµĞºÑ†Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° `## Ğ¡Ñ‚Ğ¾Ğ»Ğ¾Ğ²Ğ°Ñ ĞšĞ¥ĞŸ` â†’ "Ğ¡Ñ‚Ğ¾Ğ»Ğ¾Ğ²Ğ°Ñ ĞšĞ¥ĞŸ"
3. ĞŸĞ°Ğ¿ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ° `01_Projects/ĞšĞ¥ĞŸ/` â†’ "Ğ¡Ñ‚Ğ¾Ğ»Ğ¾Ğ²Ğ°Ñ ĞšĞ¥ĞŸ"
4. ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ Ñ‚ĞµĞ³Ğ¸ `#khp` â†’ mapping Ğ¸Ğ· ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ°
5. Default â†’ "Inbox"

#### 3. File Scanner (`src/integrations/obsidian/file_scanner.py`)

Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ vault Ğ¿Ğ¾ glob Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ°Ğ¼ Ğ¸Ğ· ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸.

#### 4. Obsidian Writer (`src/integrations/obsidian/writer.py`)

Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾ Ğ² Tasks Plugin Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ»Ñ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ°.

### ĞœĞ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

#### SyncLog
```python
class SyncLog(Base, TimestampMixin):
    id: int
    sync_type: str  # "import" | "export" | "full"
    status: str     # "pending" | "in_progress" | "completed" | "failed"
    source_file: str | None
    tasks_created: int
    tasks_updated: int
    tasks_skipped: int
    conflicts_count: int
    error_message: str | None
```

#### SyncConflict
```python
class SyncConflict(Base, TimestampMixin):
    id: int
    sync_log_id: int
    task_id: int | None
    obsidian_path: str
    obsidian_line: int
    # Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ² Ğ´Ğ»Ñ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ
    obsidian_title: str
    obsidian_status: str
    db_title: str | None
    db_status: str | None
    # Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ
    resolution: str | None  # "obsidian" | "database" | "skip"
```

### API Endpoints

```
GET  /sync/status              # Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
POST /sync/import              # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¸Ğ· Obsidian
POST /sync/export              # Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² Obsidian
GET  /sync/conflicts           # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²
POST /sync/conflicts/{id}/resolve  # Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚
GET  /sync/config              # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
PUT  /sync/config              # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
```

### ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

YAML Ñ„Ğ°Ğ¹Ğ» `config/sync_config.yaml`:
```yaml
vault_path: "/path/to/vault"
sync_sources:
  - "00_Inbox/TODO*.md"
  - "01_Projects/*/Tasks.md"
tag_mapping:
  health: "Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ"
folder_mapping:
  "01_Projects/ĞšĞ¥ĞŸ": "Ğ¡Ñ‚Ğ¾Ğ»Ğ¾Ğ²Ğ°Ñ ĞšĞ¥ĞŸ"
default_project: "Inbox"
default_conflict_resolution: "ask"
```

## Consequences

### Positive

- **Ğ”Ğ²ÑƒÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½ÑÑ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** â€” Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ Obsidian Ğ¸ Task Manager
- **Ğ“Ğ¸Ğ±ĞºĞ¸Ğ¹ Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³** â€” Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ñ‹ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑÑÑ‚ÑÑ Ğ¿Ğ¾ Ñ‚ĞµĞ³Ğ°Ğ¼, Ğ¿Ğ°Ğ¿ĞºĞ°Ğ¼, ÑĞµĞºÑ†Ğ¸ÑĞ¼
- **UI Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²** â€” Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ñ€Ğ°ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¹
- **ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ** â€” Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ² YAML Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ°
- **ĞÑƒĞ´Ğ¸Ñ‚** â€” Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ»Ğ¾Ğ³ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¹

### Negative

- **Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ°** â€” Tasks Plugin Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ½ĞµÑ„Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½
- **ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ vault Ğ¿Ñ€Ğ¸ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğµ
- **ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ñ‹** â€” Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ñ€Ğ°ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸ÑÑ…

### Mitigation

- Ğ˜Ğ½ĞºÑ€ĞµĞ¼ĞµĞ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ mtime Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ)
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ² Ğ¿Ğ¾ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ (obsidian-wins / db-wins)
- ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ°ÑĞ¿Ğ°Ñ€ÑĞµĞ½Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

## Related

- [ADR-0013: Tag Normalization for Obsidian](0013-tag-normalization-for-obsidian.md)
- [Obsidian Tasks Plugin Documentation](https://publish.obsidian.md/tasks/)
