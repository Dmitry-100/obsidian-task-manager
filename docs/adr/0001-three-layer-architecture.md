# ADR 0001: Three-Layer Architecture

## Status
Accepted

## Context
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –±—ã–ª–æ –≤—ã–±—Ä–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Task Manager. –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–æ—ë–≤
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è –¥–ª—è –æ–±—É—á–∞—é—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## Decision
–ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **3-Layer Architecture** —Å —á—ë—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º:

```
API Layer (FastAPI endpoints)
    ‚Üì
Service Layer (Business Logic)
    ‚Üì
Repository Layer (Data Access)
    ‚Üì
Database
```

–ö–∞–∂–¥—ã–π —Å–ª–æ–π –∏–º–µ–µ—Ç —Å–≤–æ—é –∑–æ–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
- **API Layer**: HTTP requests/responses, –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic
- **Service Layer**: –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- **Repository Layer**: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, SQL queries, —Ä–∞–±–æ—Ç–∞ —Å ORM

## Alternatives Considered
1. **MVC (Model-View-Controller)**: –û—Ç–∫–ª–æ–Ω–µ–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –Ω–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
2. **–ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –û—Ç–∫–ª–æ–Ω–µ–Ω–æ –∏–∑-–∑–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–æ—Å—Ç–∞ complexity
3. **Clean Architecture (–º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–∞—è)**: –ò–∑–±—ã—Ç–æ—á–Ω–∞ –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
4. **CQRS**: –ü—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ —Ç–∞–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞

## Consequences

### Positive
- ‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –∫–∞–∂–¥—ã–π —Å–ª–æ–π —Ä–µ—à–∞–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Service –±–µ–∑ API, Repository –±–µ–∑ Service
- ‚úÖ **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å, –≥–¥–µ –∏—Å–∫–∞—Ç—å –ª–æ–≥–∏–∫—É
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ –≤—Å–µ —Å–ª–æ–∏
- ‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: Service –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–∑ —Ä–∞–∑–Ω—ã—Ö API endpoints

### Negative
- ‚ùå **Boilerplate –∫–æ–¥**: –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö CRUD –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å 3 —Ñ–∞–π–ª–∞ (API + Service + Repository)
- ‚ùå **Overhead**: –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–æ—Ö–æ–¥–∏–º —á–µ—Ä–µ–∑ 3 —Å–ª–æ—è
- ‚ùå **–°–ª–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤**: –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏—é —Å–ª–æ—ë–≤

### Neutral
- üîÑ **Dependency Direction**: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–¥—É—Ç —Ç–æ–ª—å–∫–æ –≤–Ω–∏–∑ (API ‚Üí Service ‚Üí Repository)
- üîÑ **Transaction Management**: –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Ä–∞–∑–º–∞–∑–∞–Ω–∞ –º–µ–∂–¥—É Service –∏ Dependency

## Examples
```python
# API Layer
@router.post("/projects")
async def create_project(
    data: ProjectCreate,
    service: ProjectService = Depends(get_project_service)
):
    project = await service.create_project(name=data.name, color=data.color)
    return ProjectResponse.model_validate(project)

# Service Layer
async def create_project(self, name: str, color: str) -> Project:
    # Business validation
    if not name.strip():
        raise ValueError("Name cannot be empty")

    # Data operation
    project = await self.project_repo.create(Project(name=name, color=color))
    await self.db.flush()
    return project

# Repository Layer
async def create(self, obj: Project) -> Project:
    self.db.add(obj)
    await self.db.flush()
    await self.db.refresh(obj)
    return obj
```

## Notes
–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ ADR —Å—Ç—Ä–æ—è—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–µ.
